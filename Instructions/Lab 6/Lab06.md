# Lab 06 - Build a REST API using Quarkus with the help of GitHub Copilot

**Goal**

The goal of this lab is to learn how to use GitHub Copilot, using an
tasks that consists of building a REST API
using [<u>Quarkus</u>](https://quarkus.io/).

We have created a Quarkus project with some files already created, you
can find the project in the folder **exercisefiles/quarkus**.

Let's start copiloting !

**Task 1 - Create the code to handle a simple GET request**

Move to the 'DemoResource.java' file and start writing the code to
handle a simple GET request.

1.  In this first step, we have provided a comment that describes the
    code you need to generate. Just press enter and wait a couple of
    seconds.

<img src="./media/image1.png" style="width:6.5in;height:2.725in" />

2.  Copilot will generate the code for you.If you are not happy with the
    code press Ctrl +Enter and it will suggest multiple code options.

> <img src="./media/image2.png" style="width:6.5in;height:4.58403in"
> alt="A screenshot of a computer Description automatically generated" />

3.  . If you are not happy with the code generated, you can press enter
    again and Copilot will generate a new code

> <img src="./media/image3.png" style="width:6.5in;height:3.07361in"
> alt="A screenshot of a computer Description automatically generated" />
>
> <img src="./media/image4.png" style="width:6.5in;height:3.46319in"
> alt="A screenshot of a computer program Description automatically generated" />
>
> <img src="./media/image5.png" style="width:6.5in;height:3.48681in"
> alt="A screenshot of a computer program Description automatically generated" />
>
> 5\. Go to **test/java/com/Microsoft/hackthon/quarkus/** and click on
> **DemoResourceTest.java**. There is already a unit test implemented
> for this task.
>
> <img src="./media/image6.png" style="width:6.5in;height:2.71319in"
> alt="A screenshot of a computer Description automatically generated" />
>
> 6\. Click on **Terminal -\> New Terminal.**
>
> <img src="./media/image7.png"
> style="width:6.49167in;height:3.58333in" />
>
> 7\. Select **Gitbash**.
>
> <img src="./media/image8.png" style="width:6.5in;height:2.98125in" />
>
> 8\. Run cd exercisefiles/quarkus/copilot-demo/ command.
>
> <img src="./media/image9.png" style="width:6.5in;height:2.25556in"
> alt="A screen shot of a computer program Description automatically generated" />
>
> 9\. You can run it using the command mvn test before and after to
> validate that the code generated by Copilot is correct.
>
> <img src="./media/image10.png" style="width:6.5in;height:4.18542in"
> alt="A screenshot of a computer program Description automatically generated" />
>
> <img src="./media/image11.png" style="width:6.5in;height:3.71806in"
> alt="A screen shot of a computer Description automatically generated" />
>
> <img src="./media/image12.png" style="width:6.5in;height:4.45139in"
> alt="A screenshot of a computer program Description automatically generated" />

7\. After every task, feel free to package and run your application to
test it.

Package:  mvn package

<img src="./media/image13.png" style="width:6.5in;height:4.30139in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image14.png" style="width:6.5in;height:4.8125in"
alt="A screenshot of a computer program Description automatically generated" />

8\. Run:  mvn quarkus:dev

<img src="./media/image15.png" style="width:6.5in;height:6.03958in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image16.png" style="width:6.5in;height:4.42361in"
alt="A screenshot of a computer program Description automatically generated" />

10\. Click on Split terminal and enter the command in the 2<sup>nd</sup>
terminal and run

  curl -v <http://localhost:8080/hello?key=world>

curl <http://localhost:8080/hello>

curl <http://localhost:8080/hello?key=world>

<img src="./media/image17.png" style="width:5.90885in;height:5.20045in"
alt="A screenshot of a computer screen Description automatically generated" />

<img src="./media/image18.png"
style="width:6.49167in;height:4.36667in" />

**Task 2 : Dates comparison**

New operation under /diffdates that calculates the difference between
two dates. The operation should receive two dates as parameter in format
dd-MM-yyyy and return the difference in days.

1.  Type the following comment // New operation under /diffdates that
    calculates the difference between two dates. The operation should
    receive two dates as parameter in format dd-MM-yyyy and return the
    difference in days. and press Enter

**Note**: The comment is in the **DemoResource.java** file.

**C:\CopiolHackathon\exercisefiles\\quarkus\\copilot-demo\src\main\\java\com\microsoft\hackathon\quarkus\DemoResource.java**

<img src="./media/image19.png" style="width:6.5in;height:2.98194in"
alt="A screen shot of a computer program Description automatically generated" />

2.  Press tab and again Tab to accept the code.

> <img src="./media/image20.png" style="width:6.5in;height:5.44236in"
> alt="A screen shot of a computer program Description automatically generated" />

3.  Open DemoResourceTest.java file, create a unit test that validates
    the operation. Add //Create a unit test to validate /diffdates that
    calculates the difference between two dates and then press Enter.

<img src="./media/image21.png" style="width:6.5in;height:3.05347in"
alt="A screenshot of a computer program Description automatically generated" />

4.  Press tab to accept the code. You can also use the below code.

package com.microsoft.hackathon.quarkus;

import jakarta.ws.rs.GET;

import jakarta.ws.rs.Path;

import jakarta.ws.rs.Produces;

import jakarta.ws.rs.QueryParam;

import jakarta.ws.rs.client.Client;

import jakarta.ws.rs.client.ClientBuilder;

import jakarta.ws.rs.client.WebTarget;

import jakarta.ws.rs.core.MediaType;

import jakarta.ws.rs.core.Response;

import java.io.File;

import java.io.FileInputStream;

import java.io.IOException;

import java.io.InputStream;

import java.net.URL;

import java.nio.file.Files;

import java.nio.file.Paths;

import java.text.SimpleDateFormat;

import java.util.ArrayList;

import java.util.Date;

import java.util.List;

import java.util.Objects;

import com.fasterxml.jackson.databind.JsonNode;

import com.fasterxml.jackson.databind.ObjectMapper;

import com.fasterxml.jackson.databind.node.ObjectNode;

import io.quarkus.fs.util.ZipUtils;

/\*

\* The Demo resource should be mapped to the root path.

\*

\* Create a GET operation to return the value of a key passed as query
parameter in the request.

\*

\* If the key is not passed, return "key not passed".

\* If the key is passed, return "hello \<key\>".

\*

\*/

@Path("/")

public class DemoResource {

@GET

@Path("/hello")

@Produces(MediaType.TEXT_PLAIN)

public String hello(@QueryParam("key") String key) {

if (key == null) {

return "key not passed";

} else {

return "hello " + key;

}

}

// New operation under /diffdates that calculates the difference between
two dates. The operation should receive two dates as parameter in format
dd-MM-yyyy and return the difference in days.

@GET

@Path("/diffdates")

@Produces(MediaType.TEXT_PLAIN)

public String diffdates(@QueryParam("date1") String date1,
@QueryParam("date2") String date2) {

Objects.requireNonNull(date1, "date1 must not be null");

Objects.requireNonNull(date2, "date2 must not be null");

try {

SimpleDateFormat dateFormat = new SimpleDateFormat("dd-MM-yyyy");

Date date1Obj = dateFormat.parse(date1);

Date date2Obj = dateFormat.parse(date2);

long diffMillis = Math.abs(date1Obj.getTime() - date2Obj.getTime());

long diffDays = diffMillis / (24 \* 60 \* 60 \* 1000);

return String.valueOf(diffDays);

} catch (Exception e) {

return "invalid date format";

}

}

<img src="./media/image22.png" style="width:6.5in;height:3.49583in"
alt="A screenshot of a computer program Description automatically generated" />

5.  Open Terminal and run **mvn test** command.

<img src="./media/image23.png" style="width:6.5in;height:5.69028in"
alt="A screen shot of a computer Description automatically generated" />

<img src="./media/image24.png" style="width:6.5in;height:5.55208in"
alt="A screenshot of a computer program Description automatically generated" />

8\. Package the solution by running the command mvn package

<img src="./media/image25.png" style="width:6.5in;height:5.41667in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image26.png" style="width:6.5in;height:4.32083in"
alt="A screenshot of a computer program Description automatically generated" />

9\. Run:  mvn quarkus:dev or mvn compile quarkus:dev

<img src="./media/image27.png" style="width:6.5in;height:5.53472in"
alt="A screenshot of a computer program Description automatically generated" />

10\. split terminal and run **curl -v http://localhost:8080/diffdates**

**Task 3 : Validate the format of a spanish phone**

Validate the format of a spanish phone number (+34 prefix, then 9
digits, starting with 6, 7 or 9). The operation should receive a phone
number as parameter and return true if the format is correct, false
otherwise.

1.  Type //Validate the format of a spanish phone number (+34 prefix,
    then 9 digits, starting with 6, 7 or 9). The operation should
    receive a phone number as parameter and return true if the format is
    correct, false otherwise and press Enter. Press tab to accept the
    Coilot suggest code.

<img src="./media/image28.png" style="width:6.5in;height:3.67986in"
alt="A screen shot of a computer program Description automatically generated" />

2.  // write unit test to Validate the format of a spanish phone number
    (+34 prefix, then 9 digits, starting with 6, 7 or 9). The operation
    should receive a phone number as parameter and return true if the
    format is correct, false otherwise and press Enter. Press tab to
    accept the unit tests suggested by copilot

<img src="./media/image29.png" style="width:6.5in;height:4.78889in"
alt="A screen shot of a computer program Description automatically generated" />

3.  Open the terminal and run mvn test .

<img src="./media/image30.png" style="width:6.5in;height:4.59375in"
alt="A screen shot of a computer Description automatically generated" />

<img src="./media/image31.png" style="width:6.5in;height:4.36319in"
alt="A screenshot of a computer program Description automatically generated" />

4.  Run mvn package

<img src="./media/image32.png" style="width:6.5in;height:6.67083in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image33.png" style="width:6.5in;height:6.26806in"
alt="A screenshot of a computer program Description automatically generated" />

5.  Run mvn quarkus:dev

<img src="./media/image34.png" style="width:6.5in;height:6.60139in"
alt="A screenshot of a computer screen Description automatically generated" />

6.  click on split terminal and run in one of the terminal -

> curl -v http://localhost:8080/validatephone?phone=+34866666666
>
> curl -v http://localhost:8080/validatephone?phone=+34666666667
>
> curl -v http://localhost:8080/validatephone?phone=+34666666666

<img src="./media/image35.png" style="width:6.5in;height:4.75903in"
alt="A screenshot of a computer program Description automatically generated" />

**Task 4 : Validate the format of a spanish DNI**

Validate the format of a spanish DNI (8 digits and 1 letter). The
operation should receive a DNI as parameter and return true if the
format is correct, false otherwise.

1.  Type // Validate the format of a spanish DNI (8 digits and 1
    letter). The operation should receive a DNI as parameter and return
    true if the format is correct, false otherwise. and press Enter.
    Press tab to accept the Copilot suggest code.

<img src="./media/image36.png" style="width:6.5in;height:4.70208in"
alt="A screenshot of a computer program Description automatically generated" />

2.  Switch to **CopilotDemoApplicationTests.java**. To write a unit test
    to test for the above function, add //Write unit test to Validate
    the format of a spanish DNI (8 digits and 1 letter). The operation
    should receive a DNI as parameter and return true if the format is
    correct, false otherwise. Press Enter. Press the tab to accept the
    code.

<img src="./media/image37.png" style="width:6.5in;height:4.58819in"
alt="A screen shot of a computer program Description automatically generated" />

3.  Open terminal and run mvn test

<img src="./media/image38.png" style="width:6.5in;height:3.31042in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image39.png" style="width:6.5in;height:5.41528in"
alt="A screenshot of a computer program Description automatically generated" />

4.  Run mvn package

<img src="./media/image40.png" style="width:6.5in;height:6.07986in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image41.png" style="width:6.5in;height:6.05417in"
alt="A screenshot of a computer program Description automatically generated" />

5.  Run:  mvn quarkus:dev

<img src="./media/image42.png" style="width:6.5in;height:5.91111in"
alt="A screenshot of a computer program Description automatically generated" />

6.  Test:  curl -v
    <http://localhost:8080/hello/validatedni?dni=12345678A>

<img src="./media/image43.png" style="width:6.5in;height:4.79931in"
alt="A screenshot of a computer program Description automatically generated" />

**Task 5: From color name to hexadecimal code**

Based on the existing colors.json file under resources, given the name
of the color as path parameter, return the hexadecimal code. If the
color is not found, return 404

Hint: Use TDD. Start by creating the unit test and then implement the
code.

1.  Type // Based on the existing colors.json file under resources,
    given the name of the color as path parameter, return the
    hexadecimal code. If the color is not found, return 404. and press
    Enter. Press tab to accept the Copilot suggest code.

<img src="./media/image44.png" style="width:6.5in;height:5.24931in"
alt="A screenshot of a computer program Description automatically generated" />

2.  Switch to **CopilotDemoApplicationTests.java**. To write a unit test
    to test for the above function, add //Write unit test to Based on
    the existing colors.json file under resources, given the name of the
    color as path parameter, return the hexadecimal code. If the color
    is not found, return 404. Press Enter. Press the tab to accept the
    code.

<img src="./media/image45.png" style="width:6.5in;height:3.60417in"
alt="A screenshot of a computer program Description automatically generated" />

3.  Run mvn test

<img src="./media/image46.png" style="width:6.5in;height:4.55486in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image47.png" style="width:6.5in;height:5.96181in"
alt="A screenshot of a computer program Description automatically generated" />

4.  Run mvn package

<img src="./media/image48.png" style="width:6.5in;height:6.24444in"
alt="A screenshot of a computer Description automatically generated" />

5.  Run:  mvn quarkus:dev

<img src="./media/image49.png" style="width:6.5in;height:5.75694in"
alt="A screenshot of a computer program Description automatically generated" />

6.  Test:  curl -v http://localhost:8080/hello/color?color=red

<img src="./media/image50.png" style="width:6.5in;height:4.63889in" />

**Task 6 : Jokes creator**

Create a new operation that call the
API [<u>https://api.chucknorris.io/jokes/random</u>](https://api.chucknorris.io/jokes/random) and
return the joke.

1.  Type // Create a new operation that call the
    API [<u>https://api.chucknorris.io/jokes/random</u>](https://api.chucknorris.io/jokes/random) and
    return the joke. and press Enter. Press tab to accept the Copilot
    suggest code.

<img src="./media/image51.png" style="width:6.5in;height:3.67778in"
alt="A screenshot of a computer program Description automatically generated" />2.
Press tab to accept the code

<img src="./media/image52.png" style="width:6.5in;height:4.14931in"
alt="A screen shot of a computer program Description automatically generated" />

2.  Switch to **CopilotDemoApplicationTests.java**. To write a unit test
    to test for the above function, add //Create a new operation that
    call the
    API [<u>https://api.chucknorris.io/jokes/random</u>](https://api.chucknorris.io/jokes/random) and
    return the joke. Press Enter. Press the tab to accept the code.

<img src="./media/image53.png" style="width:6.5in;height:3.13472in"
alt="A screenshot of a computer program Description automatically generated" />

1.  Press tab to accept the code.

<img src="./media/image54.png" style="width:6.5in;height:3.46875in"
alt="A screenshot of a computer program Description automatically generated" />

2.  Click on Terminal -\> New Terminal -\>Gitbash and run below commands

> cd exercisefiles/quarkus/copilot-demo/
>
> mvn test

<img src="./media/image55.png" style="width:6.5in;height:3.89861in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image56.png" style="width:6.5in;height:5.99236in"
alt="A screenshot of a computer program Description automatically generated" />

3.  Run mvn package to package your application.

<img src="./media/image57.png" style="width:6.5in;height:6.54028in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image58.png" style="width:6.5in;height:6.14375in"
alt="A screenshot of a computer program Description automatically generated" />

4.  Run:  mvn quarkus:dev

<img src="./media/image59.png" style="width:6.5in;height:6.33542in"
alt="A screenshot of a computer program Description automatically generated" />

5.  Test:  curl -v http://localhost:8080/hello/joke

<img src="./media/image60.png" style="width:6.5in;height:4.68889in"
alt="A screenshot of a computer program Description automatically generated" />

**Task 7 : URL parsing**

Given a url as query parameter, parse it and return the protocol, host,
port, path and query parameters. The response should be in Json format.

1.  Type //Given a url as query parameter, parse it and return the
    protocol, host, port, path and query parameters. The response should
    be in Json format. and press Enter. Press tab to accept the Copilot
    suggest code.

<img src="./media/image61.png" style="width:6.5in;height:4.18194in"
alt="A screen shot of a computer program Description automatically generated" />

<img src="./media/image62.png" style="width:6.5in;height:3.88194in"
alt="A screen shot of a computer program Description automatically generated" />

2.  Switch to **CopilotDemoApplicationTests.java**. To write a unit test
    to test for the above function, add //Write unit test for Given a
    url as query parameter, parse it and return the protocol, host,
    port, path and query parameters. The response should be in Json
    format. Press Enter. Press the tab to accept the code.

<img src="./media/image63.png" style="width:6.5in;height:3.36458in"
alt="A screenshot of a computer program Description automatically generated" />

3.  Run mvn test

<img src="./media/image64.png" style="width:6.5in;height:3.61528in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image65.png" style="width:6.5in;height:5.67153in"
alt="A screenshot of a computer Description automatically generated" />

4.  Run mvn package to package your application.

<img src="./media/image66.png" style="width:6.5in;height:5.39931in"
alt="A screenshot of a computer program Description automatically generated" />

5.  Run mvn quarkus:dev

<img src="./media/image67.png" style="width:6.5in;height:5.8in"
alt="A screenshot of a computer program Description automatically generated" />

6.  Click on split terminal and run curl -v
    <http://localhost:8080/hello/parseurl?url=https://www.google.com/search?q=quarkus>

<img src="./media/image68.png" style="width:6.5in;height:4.38333in"
alt="A screenshot of a computer program Description automatically generated" />

**Task 9 : Word counting**

Given the path of a file and count the number of occurrence of a
provided word. The path and the word should be query parameters. The
response should be in Json format.

1.  Type //Given the path of a file and count the number of occurrence
    of a provided word. The path and the word should be query
    parameters. The response should be in Json format. and press Enter.
    Press tab to accept the Copilot suggest code.

<img src="./media/image69.png" style="width:6.5in;height:3.60972in"
alt="A screenshot of a computer program Description automatically generated" />

2.  Switch to **CopilotDemoApplicationTests.java**. To write a unit test
    to test for the above function, add //Write unit test to Given the
    path of a file and count the number of occurrence of a provided
    word. The path and the word should be query parameters. The response
    should be in Json format. Press Enter. Press the tab to accept the
    code.

<img src="./media/image70.png" style="width:6.5in;height:2.70972in"
alt="A screenshot of a computer program Description automatically generated" />

3.  Open **Terminal** and run mvn test

<img src="./media/image71.png" style="width:6.5in;height:3.48125in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image72.png" style="width:6.5in;height:5.54653in"
alt="A screenshot of a computer program Description automatically generated" />

4.  Run mvn package to package your application.

<img src="./media/image73.png" style="width:6.5in;height:6.04514in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image74.png" style="width:6.5in;height:5.66042in"
alt="A screenshot of a computer program Description automatically generated" />

5.  Run:  mvn quarkus:dev

<img src="./media/image75.png" style="width:6.5in;height:5.52083in"
alt="A screenshot of a computer program Description automatically generated" />

6.  Test:  curl
    <http://localhost:8080/hello/countword?path=/tmp/test.txt&word=hello>

You can ask GitHub copilot for curl command for your project.

<img src="./media/image76.png" style="width:6.5in;height:3.52014in"
alt="A screenshot of a computer program Description automatically generated" />

**Task 10 : Containerize the application**

Use the Dockerfile provided to create a docker image of the application.
In this case, the full content is provided, but in order build, run and
test the docker image, you will use Copilot as well to generate the
commands.

I have created a DOCKER.md file where we will document the steps to
build the application (native), build the container image, run the
container and test the container.

1.  In Visual Studio code, press **Ctrl +Shit + X** Search for
    **Docker** and install it.

<img src="./media/image77.png" style="width:6.5in;height:2.55069in"
alt="A screenshot of a computer Description automatically generated" />

2.  Double-click on **Desktop Docker** and sing in with your Docker
    account.

<img src="./media/image78.png" style="width:6.5in;height:4.07708in" />

3.  Press **Ctrl +Alt+I** to open the **Github Copilot chat**. Ask your
    Copilot how to build the container image, run the container, and
    test the container with the provided Dockerfile

<img src="./media/image79.png" style="width:6.5in;height:4.27778in"
alt="A screenshot of a computer program Description automatically generated" />

4.  Follow the insutruction of Copilot.Build the application: Run the
    following command in your terminal:

./mvnw package -Pnative -Dquarkus.native.container-build=true

<img src="./media/image77.png" style="width:6.5in;height:2.55069in"
alt="A screenshot of a computer Description automatically generated" />

<img src="./media/image80.png" style="width:6.5in;height:4.22431in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image81.png" style="width:6.5in;height:3.50347in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image82.png" style="width:6.5in;height:5.91389in"
alt="A screenshot of a computer program Description automatically generated" />

<img src="./media/image83.png" style="width:6.5in;height:4.24097in"
alt="A screenshot of a computer program Description automatically generated" />

5.  **Build the Docker image:** Assuming your Dockerfile is named
    **Dockerfile.native-micro**, you can use the following command:

docker build -f Dockerfile.native-micro -t my-app .

<img src="./media/image84.png" style="width:6.5in;height:3.28264in"
alt="A computer screen shot of a program Description automatically generated" />

6.  This command tells Docker to build an image using the Dockerfile
    named \`Dockerfile.native-micro\` in the current directory (\`.\` at
    the end of the command), and to tag the resulting image with the
    name \`my-app\`.

7.  Run the Docker image: After the image is built, you can run it with
    the \`docker run\` command:

docker run -p 8080:8080 my-app

<img src="./media/image85.png" style="width:6.5in;height:4.05486in" />

This command tells Docker to run a container from the \`my-app\` image,
and to map port 8080 in the container to port 8080 on the host machine.

6.  \*\*Test the application\*\*: Finally, to test if your application
    is running correctly, you can send a request to
    \`http://localhost:8080\` in your browser or using a tool like
    \`curl\`:

curl http://localhost:8080

<img src="./media/image86.png" style="width:6.5in;height:3.62569in"
alt="A screenshot of a computer program Description automatically generated" />

This command sends a GET request to your application and prints the
response. If your application is running correctly, you should see the
expected response.

Please note that these commands should be run in your terminal, not
within your Java application code.
